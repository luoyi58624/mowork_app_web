import"./app.1705392422789.js";import{X as x}from"./vendors/element-admin-layout.1705392422789.js";import{l as P,n as X,o as G,q as Q}from"./vendors/common.1705392422789.js";import{i as F,j,k as N,l as A,m as I,n as H,o as W,p as J,q as K,r as Z}from"./vendors/element-ui.1705392422789.js";import{f as U,r as _,B as O,I as $,h as z,V as q,Q as o,k as B,M as e,U as w,u as a,a6 as ee,D as te,c as ae,j as le,z as T}from"./vendors/vue.1705392422789.js";import"./vendors/varlet-ui.1705392422789.js";var oe={BASE_URL:"/mowork_app_web/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const k=P.create({baseURL:oe.VITE_SERVER_URL,timeout:15e3});k.interceptors.response.use(n=>n.data.code==200?n.data:Promise.reject(n.data));const ne=U({__name:"AddForm",props:{modelValue:{type:Boolean},getListData:{type:Function}},emits:["update:modelValue"],setup(n,{emit:y}){const m=n,v=y,f=_(),s=_(),l=_(!1),u=_(!1),t=_(""),d=O(),p=$({versionName:"0.0.1",updateDesc:""});function D(){v("update:modelValue",!1)}function Y(i){d.value=i.raw,u.value=!1}function g(){d.value=null}function L(i){a(s).clearFiles(),a(s).handleStart(i[0])}async function R(){if(d.value==null){u.value=!0;return}else u.value=!1;l.value=!0;try{const i=await k.get("getUploadToken",{params:{fileName:d.value.name}});t.value=i.data,a(s).submit()}catch(i){console.log(i),l.value=!1}}async function r(){try{await k.post("/app-version",{...p,appName:d.value.name,fileSize:d.value.size,updateDesc:p.updateDesc.split(`
`)}),m.getListData(),x("上传成功"),l.value=!1,D()}catch(i){console.log(i),x("提交失败","error"),l.value=!1}}return(i,h)=>{const V=F,E=j,b=N,C=A,S=I,M=H;return z(),q(M,{"model-value":i.modelValue,title:"上传新版本",width:"600px","destroy-on-close":"",onClose:D},{footer:o(()=>[B("span",null,[e(b,{onClick:D},{default:o(()=>[w("取消")]),_:1}),e(b,{type:"primary",loading:a(l),onClick:R},{default:o(()=>[w("确认")]),_:1},8,["loading"])])]),default:o(()=>[e(S,{ref_key:"formRef",ref:f,model:a(p),"label-width":"120"},{default:o(()=>[e(E,{label:"版本名字："},{default:o(()=>[e(V,{modelValue:a(p).versionName,"onUpdate:modelValue":h[0]||(h[0]=c=>a(p).versionName=c)},null,8,["modelValue"])]),_:1}),e(E,{label:"安装包：",required:"","show-message":a(u),error:"请选择app安装包"},{default:o(()=>{var c;return[e(C,{ref_key:"uploadRef",ref:s,accept:".apk",action:"http://upload-z2.qiniup.com",data:{token:a(t),key:(c=a(d))==null?void 0:c.name},"auto-upload":!1,limit:1,"on-exceed":L,"on-remove":g,onChange:Y,onSuccess:r},{trigger:o(()=>[e(b,{type:"primary"},{default:o(()=>[w("选择安装包")]),_:1})]),_:1},8,["data"])]}),_:1},8,["show-message"]),e(E,{label:"更新描述："},{default:o(()=>[e(V,{modelValue:a(p).updateDesc,"onUpdate:modelValue":h[1]||(h[1]=c=>a(p).updateDesc=c),type:"textarea",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}});var se={exports:{}};(function(n,y){(function(m,v){n.exports=v(X)})(G,function(m){function v(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var f=v(m),s={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(l,u){return u==="W"?l+"周":l+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(l,u){var t=100*l+u;return t<600?"凌晨":t<900?"早上":t<1100?"上午":t<1300?"中午":t<1800?"下午":"晚上"}};return f.default.locale(s,null,!0),s})})(se);Q.locale("zh-cn");function ie(n){return n==null||n==="undefined"||n===!1?!0:Array.isArray(n)?n.length===0:typeof n=="string"?n.trim().length===0:!1}const ue=U({__name:"EditForm",props:{modelValue:{type:Boolean},selectedData:{},getListData:{type:Function}},emits:["update:modelValue"],setup(n,{emit:y}){const m=n,v=y,f=_(),s=_(!1),l=_(""),u=O(),t=$({_id:null,appName:null,fileSize:null,versionName:"0.0.1",versionCode:1,updateDesc:""});function d(){Object.keys(ee(t)).forEach(r=>{ie(m.selectedData[r])||(r=="updateDesc"?t.updateDesc=m.selectedData[r].join(`
`):t[r]=m.selectedData[r])})}function p(){v("update:modelValue",!1)}function D(r){u.value=r.raw}function Y(){u.value=null}function g(r){a(f).clearFiles(),a(f).handleStart(r[0])}async function L(){s.value=!0;try{if(u.value==null)R();else{const r=await k.get("getUploadToken",{params:{fileName:u.value.name}});l.value=r.data,a(f).submit()}}catch(r){console.log(r),s.value=!1}}async function R(){var r,i;try{await k.put("/app-version",{...t,appName:((r=u.value)==null?void 0:r.name)??t.appName,fileSize:((i=u.value)==null?void 0:i.size)??t.fileSize,updateDesc:t.updateDesc.split(`
`)}),m.getListData(),x("更新成功"),s.value=!1,p()}catch(h){console.log(h),x("更新失败","error"),s.value=!1}}return(r,i)=>{const h=F,V=j,E=W,b=N,C=A,S=I,M=H;return z(),q(M,{"model-value":r.modelValue,title:"编辑App版本",width:"600px",onOpen:d,onClose:p},{footer:o(()=>[B("span",null,[e(b,{onClick:p},{default:o(()=>[w("取消")]),_:1}),e(b,{type:"primary",loading:a(s),onClick:L},{default:o(()=>[w("确认")]),_:1},8,["loading"])])]),default:o(()=>[e(S,{model:a(t),"label-width":"120"},{default:o(()=>[e(V,{label:"版本名字："},{default:o(()=>[e(h,{modelValue:a(t).versionName,"onUpdate:modelValue":i[0]||(i[0]=c=>a(t).versionName=c)},null,8,["modelValue"])]),_:1}),e(V,{label:"版本号："},{default:o(()=>[e(E,{modelValue:a(t).versionCode,"onUpdate:modelValue":i[1]||(i[1]=c=>a(t).versionCode=c),min:1},null,8,["modelValue"])]),_:1}),e(V,{label:"安装包："},{default:o(()=>{var c;return[e(C,{ref_key:"uploadRef",ref:f,accept:".apk",action:"http://upload-z2.qiniup.com",data:{token:a(l),key:(c=a(u))==null?void 0:c.name},"auto-upload":!1,limit:1,"on-exceed":g,"on-remove":Y,onChange:D,onSuccess:R},{trigger:o(()=>[e(b,{type:"primary"},{default:o(()=>[w("选择安装包")]),_:1})]),_:1},8,["data"])]}),_:1}),e(V,{label:"更新描述："},{default:o(()=>[e(h,{modelValue:a(t).updateDesc,"onUpdate:modelValue":i[2]||(i[2]=c=>a(t).updateDesc=c),type:"textarea",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}}),de=n=>{const y=_([]),m=_([]),v=_(null),f=_(!1),s=_(!1);function l(){f.value=!0,k.get(n).then(t=>{y.value=t.data}).finally(()=>{f.value=!1})}function u(t){J.confirm("你确定要删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value=!0;let d;Array.isArray(t)?d=t.join(","):d=t,k.delete(n+"/"+d).then(()=>{x("删除成功"),l()}).finally(()=>{s.value=!1})})}return{listData:y,selectedListData:m,selectedData:v,loadLoading:f,deleteLoading:s,getListData:l,deleteListData:u}};var re={BASE_URL:"/mowork_app_web/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const me={class:"p-2 flex flex-col"},pe={class:"mb-2 flex justify-end"},ye=U({__name:"index",setup(n){const{listData:y,selectedData:m,getListData:v,deleteListData:f}=de("/app-version"),s=_(!1),l=_(!1);function u(t){m.value=t,l.value=!0}return te("selectedData",m),ae(()=>{v(),console.log(re.VITE_BUILD_DIR)}),(t,d)=>{const p=N,D=K,Y=Z;return z(),le("div",me,[B("div",pe,[e(p,{type:"primary",onClick:d[0]||(d[0]=g=>s.value=!0)},{default:o(()=>[w("上传新版本")]),_:1})]),e(Y,{class:"w-full flex-1",data:a(y),border:!0,"show-overflow-tooltip":!0},{default:o(()=>[e(D,{prop:"_id",label:"ID",width:"240"}),e(D,{prop:"appName",label:"名称",width:"200",align:"center"}),e(D,{prop:"versionName",label:"版本名字",width:"100",align:"center"}),e(D,{prop:"versionCode",label:"版本号",width:"100",align:"center"}),e(D,{prop:"downloadUrl",label:"下载地址",align:"center","min-width":"150"}),e(D,{label:"操作",width:"120",align:"center"},{default:o(g=>[e(p,{link:"",type:"primary",size:"small",onClick:L=>u(g.row)},{default:o(()=>[w("编辑")]),_:2},1032,["onClick"]),e(p,{link:"",type:"danger",size:"small",onClick:L=>a(f)(g.row._id)},{default:o(()=>[w("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(ne,{modelValue:a(s),"onUpdate:modelValue":d[1]||(d[1]=g=>T(s)?s.value=g:null),"get-list-data":a(v)},null,8,["modelValue","get-list-data"]),e(ue,{modelValue:a(l),"onUpdate:modelValue":d[2]||(d[2]=g=>T(l)?l.value=g:null),"selected-data":a(m),"get-list-data":a(v)},null,8,["modelValue","selected-data","get-list-data"])])}}});export{ye as default};
