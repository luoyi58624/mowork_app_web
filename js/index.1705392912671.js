import"./app.1705392912671.js";import{X as E}from"./vendors/element-admin-layout.1705392912671.js";import{l as P,n as X,o as G,q as Q}from"./vendors/common.1705392912671.js";import{i as F,j,k as S,l as A,m as I,n as H,o as W,p as J,q as K,r as Z}from"./vendors/element-ui.1705392912671.js";import{f as U,r as f,B as q,I as $,h as z,V as O,Q as o,k as B,M as e,U as w,u as a,a6 as ee,D as te,c as ae,j as le,z as T}from"./vendors/vue.1705392912671.js";const k=P.create({baseURL:"http://106.55.62.197:11001",timeout:15e3});k.interceptors.response.use(n=>n.data.code==200?n.data:Promise.reject(n.data));const oe=U({__name:"AddForm",props:{modelValue:{type:Boolean},getListData:{type:Function}},emits:["update:modelValue"],setup(n,{emit:y}){const m=n,v=y,_=f(),s=f(),l=f(!1),i=f(!1),t=f(""),d=q(),p=$({versionName:"0.0.1",updateDesc:""});function g(){v("update:modelValue",!1)}function Y(u){d.value=u.raw,i.value=!1}function D(){d.value=null}function L(u){a(s).clearFiles(),a(s).handleStart(u[0])}async function C(){if(d.value==null){i.value=!0;return}else i.value=!1;l.value=!0;try{const u=await k.get("getUploadToken",{params:{fileName:d.value.name}});t.value=u.data,a(s).submit()}catch(u){console.log(u),l.value=!1}}async function r(){try{await k.post("/app-version",{...p,appName:d.value.name,fileSize:d.value.size,updateDesc:p.updateDesc.split(`
`)}),m.getListData(),E("上传成功"),l.value=!1,g()}catch(u){console.log(u),E("提交失败","error"),l.value=!1}}return(u,h)=>{const b=F,x=j,V=S,M=A,N=I,R=H;return z(),O(R,{"model-value":u.modelValue,title:"上传新版本",width:"600px","destroy-on-close":"",onClose:g},{footer:o(()=>[B("span",null,[e(V,{onClick:g},{default:o(()=>[w("取消")]),_:1}),e(V,{type:"primary",loading:a(l),onClick:C},{default:o(()=>[w("确认")]),_:1},8,["loading"])])]),default:o(()=>[e(N,{ref_key:"formRef",ref:_,model:a(p),"label-width":"120"},{default:o(()=>[e(x,{label:"版本名字："},{default:o(()=>[e(b,{modelValue:a(p).versionName,"onUpdate:modelValue":h[0]||(h[0]=c=>a(p).versionName=c)},null,8,["modelValue"])]),_:1}),e(x,{label:"安装包：",required:"","show-message":a(i),error:"请选择app安装包"},{default:o(()=>{var c;return[e(M,{ref_key:"uploadRef",ref:s,accept:".apk",action:"http://upload-z2.qiniup.com",data:{token:a(t),key:(c=a(d))==null?void 0:c.name},"auto-upload":!1,limit:1,"on-exceed":L,"on-remove":D,onChange:Y,onSuccess:r},{trigger:o(()=>[e(V,{type:"primary"},{default:o(()=>[w("选择安装包")]),_:1})]),_:1},8,["data"])]}),_:1},8,["show-message"]),e(x,{label:"更新描述："},{default:o(()=>[e(b,{modelValue:a(p).updateDesc,"onUpdate:modelValue":h[1]||(h[1]=c=>a(p).updateDesc=c),type:"textarea",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}});var ne={exports:{}};(function(n,y){(function(m,v){n.exports=v(X)})(G,function(m){function v(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var _=v(m),s={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(l,i){return i==="W"?l+"周":l+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(l,i){var t=100*l+i;return t<600?"凌晨":t<900?"早上":t<1100?"上午":t<1300?"中午":t<1800?"下午":"晚上"}};return _.default.locale(s,null,!0),s})})(ne);Q.locale("zh-cn");function se(n){return n==null||n==="undefined"||n===!1?!0:Array.isArray(n)?n.length===0:typeof n=="string"?n.trim().length===0:!1}const ue=U({__name:"EditForm",props:{modelValue:{type:Boolean},selectedData:{},getListData:{type:Function}},emits:["update:modelValue"],setup(n,{emit:y}){const m=n,v=y,_=f(),s=f(!1),l=f(""),i=q(),t=$({_id:null,appName:null,fileSize:null,versionName:"0.0.1",versionCode:1,updateDesc:""});function d(){Object.keys(ee(t)).forEach(r=>{se(m.selectedData[r])||(r=="updateDesc"?t.updateDesc=m.selectedData[r].join(`
`):t[r]=m.selectedData[r])})}function p(){v("update:modelValue",!1)}function g(r){i.value=r.raw}function Y(){i.value=null}function D(r){a(_).clearFiles(),a(_).handleStart(r[0])}async function L(){s.value=!0;try{if(i.value==null)C();else{const r=await k.get("getUploadToken",{params:{fileName:i.value.name}});l.value=r.data,a(_).submit()}}catch(r){console.log(r),s.value=!1}}async function C(){var r,u;try{await k.put("/app-version",{...t,appName:((r=i.value)==null?void 0:r.name)??t.appName,fileSize:((u=i.value)==null?void 0:u.size)??t.fileSize,updateDesc:t.updateDesc.split(`
`)}),m.getListData(),E("更新成功"),s.value=!1,p()}catch(h){console.log(h),E("更新失败","error"),s.value=!1}}return(r,u)=>{const h=F,b=j,x=W,V=S,M=A,N=I,R=H;return z(),O(R,{"model-value":r.modelValue,title:"编辑App版本",width:"600px",onOpen:d,onClose:p},{footer:o(()=>[B("span",null,[e(V,{onClick:p},{default:o(()=>[w("取消")]),_:1}),e(V,{type:"primary",loading:a(s),onClick:L},{default:o(()=>[w("确认")]),_:1},8,["loading"])])]),default:o(()=>[e(N,{model:a(t),"label-width":"120"},{default:o(()=>[e(b,{label:"版本名字："},{default:o(()=>[e(h,{modelValue:a(t).versionName,"onUpdate:modelValue":u[0]||(u[0]=c=>a(t).versionName=c)},null,8,["modelValue"])]),_:1}),e(b,{label:"版本号："},{default:o(()=>[e(x,{modelValue:a(t).versionCode,"onUpdate:modelValue":u[1]||(u[1]=c=>a(t).versionCode=c),min:1},null,8,["modelValue"])]),_:1}),e(b,{label:"安装包："},{default:o(()=>{var c;return[e(M,{ref_key:"uploadRef",ref:_,accept:".apk",action:"http://upload-z2.qiniup.com",data:{token:a(l),key:(c=a(i))==null?void 0:c.name},"auto-upload":!1,limit:1,"on-exceed":D,"on-remove":Y,onChange:g,onSuccess:C},{trigger:o(()=>[e(V,{type:"primary"},{default:o(()=>[w("选择安装包")]),_:1})]),_:1},8,["data"])]}),_:1}),e(b,{label:"更新描述："},{default:o(()=>[e(h,{modelValue:a(t).updateDesc,"onUpdate:modelValue":u[2]||(u[2]=c=>a(t).updateDesc=c),type:"textarea",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"])}}}),ie=n=>{const y=f([]),m=f([]),v=f(null),_=f(!1),s=f(!1);function l(){_.value=!0,k.get(n).then(t=>{y.value=t.data}).finally(()=>{_.value=!1})}function i(t){J.confirm("你确定要删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value=!0;let d;Array.isArray(t)?d=t.join(","):d=t,k.delete(n+"/"+d).then(()=>{E("删除成功"),l()}).finally(()=>{s.value=!1})})}return{listData:y,selectedListData:m,selectedData:v,loadLoading:_,deleteLoading:s,getListData:l,deleteListData:i}};var de={BASE_URL:"/mowork_app_web/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const re={class:"p-2 flex flex-col"},me={class:"mb-2 flex justify-end"},ge=U({__name:"index",setup(n){const{listData:y,selectedData:m,getListData:v,deleteListData:_}=ie("/app-version"),s=f(!1),l=f(!1);function i(t){m.value=t,l.value=!0}return te("selectedData",m),ae(()=>{v(),console.log(de.VITE_BUILD_DIR)}),(t,d)=>{const p=S,g=K,Y=Z;return z(),le("div",re,[B("div",me,[e(p,{type:"primary",onClick:d[0]||(d[0]=D=>s.value=!0)},{default:o(()=>[w("上传新版本")]),_:1})]),e(Y,{class:"w-full flex-1",data:a(y),border:!0,"show-overflow-tooltip":!0},{default:o(()=>[e(g,{prop:"_id",label:"ID",width:"240"}),e(g,{prop:"appName",label:"名称",width:"200",align:"center"}),e(g,{prop:"versionName",label:"版本名字",width:"100",align:"center"}),e(g,{prop:"versionCode",label:"版本号",width:"100",align:"center"}),e(g,{prop:"downloadUrl",label:"下载地址",align:"center","min-width":"150"}),e(g,{label:"操作",width:"120",align:"center"},{default:o(D=>[e(p,{link:"",type:"primary",size:"small",onClick:L=>i(D.row)},{default:o(()=>[w("编辑")]),_:2},1032,["onClick"]),e(p,{link:"",type:"danger",size:"small",onClick:L=>a(_)(D.row._id)},{default:o(()=>[w("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(oe,{modelValue:a(s),"onUpdate:modelValue":d[1]||(d[1]=D=>T(s)?s.value=D:null),"get-list-data":a(v)},null,8,["modelValue","get-list-data"]),e(ue,{modelValue:a(l),"onUpdate:modelValue":d[2]||(d[2]=D=>T(l)?l.value=D:null),"selected-data":a(m),"get-list-data":a(v)},null,8,["modelValue","selected-data","get-list-data"])])}}});export{ge as default};
